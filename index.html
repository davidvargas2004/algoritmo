<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Financiero</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <style>
    :root {
      --primary-color: #4f46e5;
      --secondary-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --text-color: #1f2937;
      --bg-color: #f9fafb;
      --card-bg: #ffffff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 24px;
      font-weight: bold;
    }

    .total-spent {
      background-color: #e0f2fe;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: bold;
      color: #0369a1;
    }

    .alerts-container {
      margin-bottom: 24px;
      background-color: #fee2e2;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #fecaca;
    }

    .alerts-header {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      color: #b91c1c;
    }

    .alerts-header svg {
      margin-right: 8px;
    }

    .alert-item {
      margin-bottom: 8px;
      padding: 12px;
      border-radius: 6px;
    }

    .alert-high {
      background-color: #fecaca;
      border-left: 4px solid #b91c1c;
    }

    .alert-medium {
      background-color: #fed7aa;
      border-left: 4px solid #c2410c;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (min-width: 768px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .card {
      background-color: var(--card-bg);
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
    }

    .card-header svg {
      margin-right: 8px;
    }

    .chart-container {
      height: 300px;
      position: relative;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background-color: #f3f4f6;
    }

    th {
      padding: 12px 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      color: #6b7280;
    }

    td {
      padding: 16px;
      border-top: 1px solid #e5e7eb;
    }

    tr:hover {
      background-color: #f9fafb;
    }

    .category-dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background-color: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 4px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 4px;
    }

    .progress-fill-normal {
      background-color: var(--secondary-color);
    }

    .progress-fill-warning {
      background-color: var(--warning-color);
    }

    .progress-fill-danger {
      background-color: var(--danger-color);
    }

    .progress-text {
      font-size: 12px;
      color: #6b7280;
    }

    .trend-positive {
      color: var(--danger-color);
    }

    .trend-negative {
      color: var(--secondary-color);
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 9999px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-normal {
      background-color: #d1fae5;
      color: #065f46;
    }

    .badge-warning {
      background-color: #fef3c7;
      color: #92400e;
    }

    .badge-danger {
      background-color: #fee2e2;
      color: #b91c1c;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Dashboard Financiero</h1>
      <div class="total-spent">Total: $<span id="total-amount">0.00</span></div>
    </div>

    <div id="alerts-section" class="alerts-container" style="display: none;">
      <div class="alerts-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
          <path d="M12 9v4"></path>
          <path d="M12 17h.01"></path>
        </svg>
        Alertas
      </div>
      <div id="alerts-list">
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2v20"></path>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          Distribución de Gastos
        </div>
        <div class="chart-container">
          <canvas id="pie-chart"></canvas>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 7 13.5 15.5 8.5 10.5 2 17"></polyline>
            <polyline points="16 7 22 7 22 13"></polyline>
          </svg>
          Tendencia por Categoría
        </div>
        <div class="chart-container">
          <canvas id="bar-chart"></canvas>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Evolución de Gastos (Última semana)
      </div>
      <div class="chart-container">
        <canvas id="line-chart"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Detalles por Categoría</div>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>Categoría</th>
              <th>Gasto Total</th>
              <th>% del Presupuesto</th>
              <th>Tendencia</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody id="categories-table">
            <!-- Los datos se cargarán con JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Datos de ejemplo
    const financialData = {
      categorySummary: [
        { category: 'Alimentación', totalSpent: 420.75, percentageOfBudget: 84.2, trend: 12.5 },
        { category: 'Transporte', totalSpent: 150.30, percentageOfBudget: 60.1, trend: -5.3 },
        { category: 'Ocio', totalSpent: 230.50, percentageOfBudget: 115.3, trend: 45.2 },
        { category: 'Servicios', totalSpent: 180.99, percentageOfBudget: 72.4, trend: 0.8 },
        { category: 'Salud', totalSpent: 95.40, percentageOfBudget: 38.2, trend: -12.1 }
      ],
      totalSpent: 1077.94,
      alerts: [
        { category: 'Ocio', message: 'Gasto en Ocio excede el límite diario recomendado (115.30%)', severity: 'high' },
        { category: 'Alimentación', message: 'Aumento significativo en gastos de Alimentación (+12.50%)', severity: 'medium' }
      ]
    };

    // Datos de tendencia para el gráfico de líneas
    const trendData = {
      'Alimentación': [
        { date: '2025-04-16', amount: 380.25 },
        { date: '2025-04-17', amount: 355.40 },
        { date: '2025-04-18', amount: 390.80 },
        { date: '2025-04-19', amount: 375.60 },
        { date: '2025-04-20', amount: 395.25 },
        { date: '2025-04-21', amount: 410.50 },
        { date: '2025-04-22', amount: 420.75 }
      ],
      'Transporte': [
        { date: '2025-04-16', amount: 160.30 },
        { date: '2025-04-17', amount: 155.40 },
        { date: '2025-04-18', amount: 175.80 },
        { date: '2025-04-19', amount: 145.60 },
        { date: '2025-04-20', amount: 135.25 },
        { date: '2025-04-21', amount: 142.50 },
        { date: '2025-04-22', amount: 150.30 }
      ],
      'Ocio': [
        { date: '2025-04-16', amount: 120.30 },
        { date: '2025-04-17', amount: 180.40 },
        { date: '2025-04-18', amount: 145.80 },
        { date: '2025-04-19', amount: 165.60 },
        { date: '2025-04-20', amount: 195.25 },
        { date: '2025-04-21', amount: 205.50 },
        { date: '2025-04-22', amount: 230.50 }
      ],
      'Servicios': [
        { date: '2025-04-16', amount: 178.30 },
        { date: '2025-04-17', amount: 175.40 },
        { date: '2025-04-18', amount: 177.80 },
        { date: '2025-04-19', amount: 179.60 },
        { date: '2025-04-20', amount: 181.25 },
        { date: '2025-04-21', amount: 180.50 },
        { date: '2025-04-22', amount: 180.99 }
      ],
      'Salud': [
        { date: '2025-04-16', amount: 110.30 },
        { date: '2025-04-17', amount: 105.40 },
        { date: '2025-04-18', amount: 108.80 },
        { date: '2025-04-19', amount: 102.60 },
        { date: '2025-04-20', amount: 98.25 },
        { date: '2025-04-21', amount: 97.50 },
        { date: '2025-04-22', amount: 95.40 }
      ]
    };

    // Colores para categorías
    const COLORS = [
      '#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8'
    ];

    // Función para inicializar el dashboard
    function initDashboard() {
      // Mostrar total
      document.getElementById('total-amount').textContent = financialData.totalSpent.toFixed(2);

      // Mostrar alertas si existen
      renderAlerts();

      // Inicializar gráficos
      initPieChart();
      initBarChart();
      initLineChart();

      // Renderizar tabla de categorías
      renderCategoriesTable();
    }

    // Renderizar alertas
    function renderAlerts() {
      const alertsList = document.getElementById('alerts-list');
      const alertsSection = document.getElementById('alerts-section');
      
      if (financialData.alerts && financialData.alerts.length > 0) {
        alertsSection.style.display = 'block';
        alertsList.innerHTML = '';
        
        financialData.alerts.forEach(alert => {
          const alertDiv = document.createElement('div');
          alertDiv.className = `alert-item alert-${alert.severity}`;
          alertDiv.innerHTML = `<p><strong>${alert.category}:</strong> ${alert.message}</p>`;
          alertsList.appendChild(alertDiv);
        });
      } else {
        alertsSection.style.display = 'none';
      }
    }

    // Inicializar gráfico circular
    function initPieChart() {
      const ctx = document.getElementById('pie-chart').getContext('2d');
      
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: financialData.categorySummary.map(item => item.category),
          datasets: [{
            data: financialData.categorySummary.map(item => item.totalSpent),
            backgroundColor: COLORS,
            borderColor: '#ffffff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.raw || 0;
                  const total = context.chart.data.datasets[0].data.reduce((a, b) => a + b, 0);
                  const percentage = Math.round((value / total) * 100);
                  return `${label}: $${value.toFixed(2)} (${percentage}%)`;
                }
              }
            }
          }
        }
      });
    }

    // Inicializar gráfico de barras
    function initBarChart() {
      const ctx = document.getElementById('bar-chart').getContext('2d');
      
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: financialData.categorySummary.map(item => item.category),
          datasets: [
            {
              label: 'Gasto ($)',
              data: financialData.categorySummary.map(item => item.totalSpent),
              backgroundColor: '#8884d8',
              borderColor: '#7979ca',
              borderWidth: 1,
              yAxisID: 'y'
            },
            {
              label: 'Tendencia (%)',
              data: financialData.categorySummary.map(item => item.trend),
              backgroundColor: '#82ca9d',
              borderColor: '#74b88e',
              borderWidth: 1,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              grid: {
                display: false
              }
            },
            y: {
              position: 'left',
              title: {
                display: true,
                text: 'Gasto ($)'
              },
              beginAtZero: true
            },
            y1: {
              position: 'right',
              title: {
                display: true,
                text: 'Tendencia (%)'
              },
              grid: {
                drawOnChartArea: false
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.dataset.label || '';
                  const value = context.raw || 0;
                  
                  if (label === 'Tendencia (%)') {
                    return `${label}: ${value > 0 ? '+' : ''}${value.toFixed(2)}%`;
                  }
                  return `${label}: $${value.toFixed(2)}`;
                }
              }
            }
          }
        }
      });
    }

    // Inicializar gráfico de líneas
    function initLineChart() {
      const ctx = document.getElementById('line-chart').getContext('2d');
      
      // Obtener fechas únicas de todos los datasets
      const allDates = new Set();
      Object.values(trendData).forEach(categoryData => {
        categoryData.forEach(item => allDates.add(item.date));
      });
      const dates = Array.from(allDates).sort();
      
      // Crear datasets para cada categoría
      const datasets = Object.keys(trendData).map((category, index) => {
        const categoryData = trendData[category];
        
        // Crear un mapa de fecha -> cantidad para búsqueda eficiente
        const dateMap = {};
        categoryData.forEach(item => {
          dateMap[item.date] = item.amount;
        });
        
        return {
          label: category,
          data: dates.map(date => dateMap[date] || null),
          borderColor: COLORS[index % COLORS.length],
          backgroundColor: `${COLORS[index % COLORS.length]}22`,
          borderWidth: 2,
          pointRadius: 3,
          pointHoverRadius: 5,
          tension: 0.1,
          fill: false
        };
      });
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: datasets
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: false,
              title: {
                display: true,
                text: 'Gasto ($)'
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.dataset.label || '';
                  const value = context.raw || 0;
                  return value ? `${label}: $${value.toFixed(2)}` : `${label}: No data`;
                }
              }
            }
          }
        }
      });
    }

    // Renderizar tabla de categorías
    function renderCategoriesTable() {
      const tableBody = document.getElementById('categories-table');
      tableBody.innerHTML = '';
      
      financialData.categorySummary.forEach((item, index) => {
        const row = document.createElement('tr');
        
        // Columna de categoría
        const categoryCell = document.createElement('td');
        categoryCell.innerHTML = `
          <div style="display: flex; align-items: center;">
            <span class="category-dot" style="background-color: ${COLORS[index % COLORS.length]}"></span>
            ${item.category}
          </div>
        `;
        row.appendChild(categoryCell);
        
        // Columna de gasto total
        const totalCell = document.createElement('td');
        totalCell.innerHTML = `$${item.totalSpent.toFixed(2)}`;
        totalCell.style.fontWeight = '500';
        row.appendChild(totalCell);
        
        // Columna de porcentaje de presupuesto
        const percentageCell = document.createElement('td');
        const progressClass = item.percentageOfBudget > 100 ? 'progress-fill-danger' : 
                             item.percentageOfBudget > 80 ? 'progress-fill-warning' : 
                             'progress-fill-normal';
        percentageCell.innerHTML = `
          <div class="progress-bar">
            <div class="progress-fill ${progressClass}" style="width: ${Math.min(item.percentageOfBudget, 100)}%"></div>
          </div>
          <div class="progress-text">${item.percentageOfBudget.toFixed(1)}%</div>
        `;
        row.appendChild(percentageCell);
        
        // Columna de tendencia
        const trendCell = document.createElement('td');
        const trendClass = item.trend > 0 ? 'trend-positive' : 'trend-negative';
        trendCell.innerHTML = `<span class="${trendClass}">${item.trend > 0 ? '+' : ''}${item.trend.toFixed(2)}%</span>`;
        row.appendChild(trendCell);
        
        // Columna de estado
        const statusCell = document.createElement('td');
        let badgeClass = 'badge-normal';
        let statusText = 'Normal';
        
        if (item.percentageOfBudget > 100) {
          badgeClass = 'badge-danger';
          statusText = 'Excedido';
        } else if (item.percentageOfBudget > 80) {
          badgeClass = 'badge-warning';
          statusText = 'Alerta';
        }
        
        statusCell.innerHTML = `<span class="badge ${badgeClass}">${statusText}</span>`;
        row.appendChild(statusCell);
        
        tableBody.appendChild(row);
      });
    }

    // Simular una conexión a la API
    function fetchData() {
      return new Promise((resolve) => {
        setTimeout(() => {
          resolve({
            analysis: financialData,
            trends: trendData
          });
        }, 500);
      });
    }

    // Inicializar dashboard al cargar la página
    document.addEventListener('DOMContentLoaded', async () => {
      // Simular carga de datos
      const data = await fetchData();
      
      // Inicializar el dashboard
      initDashboard();
    });
  </script>
</body>
</html>